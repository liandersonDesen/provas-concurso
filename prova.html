<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <title>Simulado</title>
    <style>
        body {
            font-family: sans-serif;
            background: #f4f4f4;
            padding: 20px;
        }

        .enunciado-texto {
            white-space: pre-wrap;
            /* Isso faz as quebras de linha aparecerem */
            word-wrap: break-word;
            /* Garante que palavras muito longas não quebrem o layout */
            display: block;
            margin-bottom: 10px;
        }

        .cartao-prova {
            background: white;
            max-width: 700px;
            margin: auto;
            padding: 20px;
            border-radius: 8px;
        }

        .questao {
            margin-bottom: 25px;
            padding: 15px;
            border-bottom: 1px solid #eee;
        }

        .opcao {
            display: block;
            margin: 8px 0;
            cursor: pointer;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .correta {
            background: #d4edda !important;
            border-color: #c3e6cb !important;
            font-weight: bold;
        }

        .errada {
            background: #f8d7da !important;
            border-color: #f5c6cb !important;
        }

        #resultado {
            font-size: 20px;
            font-weight: bold;
            margin-top: 20px;
            color: #007bff;
        }
    </style>
</head>

<body>

    <div class="cartao-prova">
        <h1 id="tituloProva">Carregando...</h1>
        <div id="conteudoProva"></div>
        <button id="btnFinalizar" onclick="corrigirProva()"
            style="display:none; width: 100%; padding: 15px; background: #28a745; color: white; border: none; border-radius: 5px; font-size: 18px; cursor: pointer;">Finalizar
            e Ver Nota</button>
        <div id="resultado"></div>
    </div>

    <script>
        let dadosDaProva = null;

        // 1. Pega o ID da URL e busca no Banco
        async function iniciar() {
            const params = new URLSearchParams(window.location.search);
            const id = params.get('id');

            const response = await fetch(`https://provas-concurso.onrender.com/prova/${id}`);
            dadosDaProva = await response.json();

            document.getElementById('tituloProva').innerText = dadosDaProva.nomeProva;
            renderizarQuestoes();
        }

        // 2. Desenha as questões na tela
        function renderizarQuestoes() {
            const container = document.getElementById('conteudoProva');
            dadosDaProva.questoes.forEach((q, i) => {
                const div = document.createElement('div');
                div.className = 'questao';
                div.innerHTML = `
                <p class="enunciado-texto"><strong>${i + 1}. ${q.enunciado}</strong></p>
                ${q.alternativas.map((alt, indexAlt) => `
                    <label class="opcao" id="label-${i}-${indexAlt}">
                        <input type="radio" name="pergunta${i}" value="${indexAlt}"> ${alt}
                    </label>
                `).join('')}
                <p class="feedback" id="feedback-${i}" style="display:none"></p>
            `;
                container.appendChild(div);
            });
            document.getElementById('btnFinalizar').style.display = 'block';
        }

        // 3. A Lógica de Comparação que você queria
        function corrigirProva() {
            let acertos = 0;

            dadosDaProva.questoes.forEach((q, i) => {
                const selecionada = document.querySelector(`input[name="pergunta${i}"]:checked`);
                const feedback = document.getElementById(`feedback-${i}`);

                if (selecionada) {
                    const valorMarcado = parseInt(selecionada.value);

                    // Pinta a correta de verde sempre
                    document.getElementById(`label-${i}-${q.correta}`).classList.add('correta');

                    if (valorMarcado === q.correta) {
                        acertos++;
                    } else {
                        // Se errou, pinta a que ele marcou de vermelho
                        document.getElementById(`label-${i}-${valorMarcado}`).classList.add('errada');
                    }
                }
                feedback.style.display = 'block';
            });

            document.getElementById('resultado').innerText = `Você acertou ${acertos} de ${dadosDaProva.questoes.length} questões!`;
            window.scrollTo(0, 0); // Sobe a página para ver o resultado
        }

        iniciar();
    </script>
</body>

</html>